# Todo w. drf and vue

## 0. 모델 정의

- Todo
  - id
  - is_completed : Boolean
  - content: Char
  - created_at: DateTime
  - order: Float

## 1. 필요한 api

- `POST /api/v1/todo`
  - request
    - content
  - response
    - status: success / failure 중 한 가지 값
    - error: failure 시 error message 전달
    - todo
      - id
      - isCompleted
      - content (최대 200자)
      - created_at
      - order: 정렬에 쓰일 실수형 수
- `GET /api/v1/todo`
  - request
  - response
    - todos: todo 배열
      - id
      - isCompleted
      - content
      - created_at
      - order: 정렬에 쓰일 실수형 수
- `PATCH /api/v1/todo/:id`
  - request
    - isCompleted
    - content
    - order
  - response
    - status: success / failure
    - error: failure 일 때 error 메세지
    - todo
      - id
      - isCompleted
      - content
      - created_at
      - order
- `DELETE /api/v1/todo/:id`
  - request
  - response
    - status: success / failure

## 2. 기능 명세

- 작업 추가 란에서 할 일 추가
  - POST todo
  - 엔터 치면 추가
  - 공백일 경우 추가 안됨, 공백으로 초기화 포커스 유지 - 흔들리는 애니메이션
  - 작업추가란 바텀 이나 탑 적절한 곳에 고정
- 할 일 리스트 전부 조회해서 나타냄
  - GET todo
  - 리스트에는 완료 여부 아이콘, 완료된 애들은 회색 글씨 + 취소선
- 완료된 작업 표시 / 숨기기 버튼
  - 누르면 아래에 완료됨 영역 생기거나 사라지거나
- 할 일의 동그라미 누르면
  - PATCH isCompleted 수정 요청
  - 띵 소리와 함께 사라지는 애니메이션
- 할 일 리스트 수정
  - 엔터 누르면 수정
  - 값이 비었으면 진동
  - 수정되고 나서 포커스아웃(블러)
  - 엔터 누르지 않고 포커스 아웃 되면 다시 원래 값으로 돌림
- 할일 드래그
  - PATCH 목록 순서 수정 - 수정된 위치의 이전과 이후의 중간으로 order값 수정 요청
- 할일 삭제
  - 컴펌 받는 모달이나 그냥 컨펌창
  - 휴지통 소리나면서 삭제요청

## 3. 개발 일지

### 1. 백엔드

- 아이템의 순서를 db에 기록을 할 때, 어떻게 해야할 까 - order라는 FloatField를 만들고, 초기 값은 id와 같도록 지정했다. 나중에 순서가 조정되면, 이전 아이템의 order와 다음아이템의 order의 중간값을 넣어 업데이트 할 생각.

  - `__init__` 에서 order값 id로 지정해준 것 까진 좋았는데, 처음선언할 때 `*args,**kwargs` 해주는거 깜빡함. `super().__init__()`에서 `init` 에다가 `*args, **kwargs` 넘겨 주는 거도 같이 깜빡함.

    ```sh
    TypeError: __init__() got an unexpected keyword argument 'content'
    ```

  - 왜 model클래스에서 `__init__` 의 `self`에 접근하지 못할까??

  - default가 굳이 id가 아니더라도 그냥 auto increse하기만 하면 되는데, 굳이 그거에 갇혀서 삽질을 오지게 했다. django의 `AutoField` 는 정수형이라 내가 구현하고자 하는 알고리즘에 맞지 않아서, 커스텀 클래스를 만들어서 사용했다. 필드의 `default` 옵션에 콜백을 줄 수 있는 지 처음 알았다.

  - 이러니까 서버를 껐다 켰을 때가 문제다..ㅠㅠ 결국 db를 활용하긴 해야되는데..어떡해야하나 아 커밋폴스로 해결해볼까 - save를 해야 id가 생기는듯  그냥 두번 요청보내는 걸로 합의 - 실제로 쿼리 두번날리는 거겠지?.. 일단 넘어감 되니까

- `serializer` 에 인스턴스 불러와서 지정해줄 때 `many=True` 빼먹어서 헤맴

  ```sh
  AttributeError: Got AttributeError when attempting to get a value for field `content` on serializer `TodoSerializer`.
  The serializer field might be named incorrectly and not match any attribute or key on the `QuerySet` instance.
  Original exception text was: 'QuerySet' object has no attribute 'content'.
  ```

- 처음 시작할 때는 try except로 감싸서 status 구현해줄랬는데, 순서 알고리즘 구현하다가 시간 다잡아먹고 체력도 떨어져서 스킵

### 2. 프론트엔드

- 컴포넌트 구조 짜보자 (대문자는 컴포넌트 이름, 소문자는 data)
  - App
    - todos
    - TodoInput
      - newTodo
    - TodoList
      - toggleDisplayCompleted
      - TodoListItem
- `@blur` : focus out 이벤트
- 수정 완료될 경우 blur이벤트 발생시키기 위해 ref속성 사용
- 완료 여부 수정하다보니까 PATCH로 `isCompleted`만 전송하니까 valid 통과 못함 - content 영역 `blank=True` 옵션 추가해 줬는데, 이렇게 하면 빈 투두를 만들 때 서버 쪽에서 검증이 안된다. 아마 validation 로직을 따로 짜서 활용하는 기능이 있을 것 같은데, 귀찮으므로 패스. PATCH를 할 때 `content`를 넣어서 요청보낼 수도 있는데, 이렇게 하려면 `PUT` 요청이 아마 더 맞을 거다.
- `keydown`으로 한글 치고 엔터 처리하니까 요청 두 번 간다. mac에서만 그런건지는 모르겠는데 `keypress`로 바꾸자
- 투두 순서 드래그해서 바뀔 수 있게 해볼랬는데, 기존에 있던 vuedraggable은 커스터마이징 하려니까 또 사용법을 익히는 느낌이라 일단 배포부터 해놓고, vanillajs로 만들어보기로 생각함

### 3. 알게 된 잡 지식

- mac기준 `ctrl + -` 누르면 이전 커서 위치로 돌아감 개꿀

